<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fetch | axios</title>
    <style>
        table {
            border: 1px solid black;
            border-collapse: collapse;
            margin: 20px;
        }
        table#tbl_user {
            display: none;
        }
        th, td {
            border: 1px solid black;
            padding: 5px;
        }
        .avatar img {
            width: 300px;
            border-radius: 50%;
            margin: 20px;
        }
        #dogImg {
            width: 300px;
            margin: 20px;
        }
        .animal-wrapper {
            margin: 20px 0;
            display: flex;
            justify-content: space-around;
        }
        #card {
            width: 300vw;
            padding: 5px;
            border: 1px solid #bbb;
        }
        #cat {
            border-radius: 10%;
            width: 100%;
        }
        
    </style>
</head>
<body>
    <h1>fetch</h1>
    <button id="btn1">fetch</button>
    <table id="tbl_user">
        <tr>
            <th>이름</th>
            <td class="id"></td>
        </tr>
        <tr>
            <th>교육원</th>
            <td class="company"></td>
        </tr>
        <tr>
            <th>강의장</th>
            <td class="classroom"></td>
        </tr>
        <tr>
            <th>개수</th>
            <td class="cnt"></td>
        </tr>
    </table>
    
    <script>
        /**
         * 네트워크요청은 비동기 처리
         * 1. XMLHttpRequest객체
         * 2. fetch (Promise 기반)
         *  - fetch호출을 promise반환
         *  - Promise의 result값으로 응답객체를 전달해준다. 실제 메세지가 적힌 body속성값은 바로 열람할 수 없다.
         *  - text() 또는 json() 호출해 반환해야 한다. 프라미스체인 사용
         */
        btn1.onclick = () => {
            const USER_URL = "https://asia-northeast3-focal-elf-326215.cloudfunctions.net/user";

            fetch(USER_URL)
            .then((response) => {
                // 소비코드
                console.log(response);
                return response.json(); // 암묵적 promise의 result값
            })
            .then((data) => {
                // JSON.parse 리턴값 : js객체
                console.log(data);
                // document.querySelector(".id").innerHTML = data.id;
                // document.querySelector(".company").innerHTML = data.company;
                // document.querySelector(".classroom").innerHTML = data.classroom;
                // document.querySelector(".cnt").innerHTML = data.cnt;
                // document.querySelector("#tbl_user").style.display = 'block';

                const {id, company, classroom, cnt} = data;
                const table = document.querySelector("table#tbl_user");
                table.querySelector(".id").innerHTML = id;
                table.querySelector(".company").innerHTML = company;
                table.querySelector(".classroom").innerHTML = classroom;
                table.querySelector(".cnt").innerHTML = cnt;
                table.style.display = 'block';
            })

        };
    </script>

    <button id="btn2">github avatar</button>
    <div class="avatar"></div>
    <script>
        /**
         * 사용자로부터 github아이디를 입력받고, 프로필사진을 렌더하기
         * - prompt
         * - url요청
         * - 3초 노출후 제거
         */
        btn2.onclick = () => {
            const id = prompt('id 입력해', 'khendev23');
            const GITHUB_URL = `https://api.github.com/users/${id}`;

            // fetch(GITHUB_URL, {
            //     headers: {
            //         // Authorization: `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`
            //     }
            // })
            requestUrl(GITHUB_URL)
            // .then((response) => {
            //     return response.json();
            // })
            .then((data) => {
                const avatarUrl = data.avatar_url;
                const image = document.createElement('img');
                image.id = "avatarImg";
                image.src = avatarUrl;
                btn2.nextElementSibling.append(image);
                
                image.onload = () => {
                    setTimeout(() => {
                        document.querySelector("#avatarImg").remove();
                    }, 3000);
                }
            })
        };

        const requestUrl = (url) => fetch(url).then(response => response.json());
    </script>

    <h1>axios</h1>
    <button id="btn3">axios</button>
    <button id="btn4">dog</button>
    <button id="btn5">cat</button>
    <div class="animal-wrapper">
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <script>
        /**
         * 랜덤 고양이사진
         */
        btn5.onclick = () => {
            const api_key = 'live_Q7MJ4kImkRQ2vO4X8USrChzxeT6r0eg9WxImeEAONfgTY9zBgO5HK1FRlBt2Je9z';
            const cat_url = `https://api.thecatapi.com/v1/images/search`;
            axios.get(cat_url, {
                params : {
                    has_breeds : 1,
                    limit : 3,
                    api_key
                }
            })
            .then(({data}) => {
                console.log(data);
                
                for(let i = 0; i<data.length; i++) {
                    const animalWrapper = document.querySelector(".animal-wrapper");
                    const catCard = document.createElement('div');
                    const catImg = document.createElement('img');
                    const catH3 = document.createElement('h3');
                    const catP = document.createElement('p');
                    catCard.id = "card";
                    animalWrapper.appendChild(catCard);
                    let catUrl = data[i].url;
                    let catName = data[i].breeds[0].name;
                    let catOrigin = data[i].breeds[0].origin;
                    catH3.innerHTML = catName;
                    catP.innerHTML = catOrigin;
                    catImg.id = 'cat';
                    catImg.src = catUrl;
                    catCard.appendChild(catImg);
                    catCard.appendChild(catH3);
                    catCard.appendChild(catP);
                }
            })
        };

        /**
         * 랜덤 개사진
         */
        btn4.onclick = () => {
            const url = 'https://dog.ceo/api/breeds/image/random';
            axios.get(url)
            .then(({data}) => {
                const dogUrl = data.message;
                const dogImg = document.createElement('img');
                dogImg.id = "dogImg";
                dogImg.src = dogUrl;
                document.querySelector(".animal-wrapper").append(dogImg);
            })
        }

        /**
         * axios
         * - promise 기반의 웹요청 라이브러리
         * - cdn으로 js 로드후 사용(js표준이 아니다.)
         * - 응답메세지에서 body를 추출하는 프라미스단계 제거
         */
        btn3.onclick = () => {
            axios.get('https://api.github.com/users/khendev23', {
                headers: {
                    Authorization: `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`
                }
            })
            .then((response) => {
                console.log(response);
                console.log(response.data.avatar_url);
            })
        };
    </script>
</body>
</html>